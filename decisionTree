{"paragraphs":[{"text":"import org.apache.spark.ml.Pipeline\r\nimport org.apache.spark.ml.classification.DecisionTreeClassificationModel\r\nimport org.apache.spark.ml.classification.DecisionTreeClassifier\r\nimport org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator\r\nimport org.apache.spark.ml.feature.{IndexToString, StringIndexer, VectorIndexer}\r\nimport org.apache.spark.ml.feature.VectorAssembler\r\nimport org.apache.spark.ml.linalg.Vectors\r\nimport org.apache.spark.ml.feature.StringIndexer\r\nimport org.apache.spark.sql.functions._","dateUpdated":"2017-12-04T22:24:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.ml.Pipeline\nimport org.apache.spark.ml.classification.DecisionTreeClassificationModel\nimport org.apache.spark.ml.classification.DecisionTreeClassifier\nimport org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator\nimport org.apache.spark.ml.feature.{IndexToString, StringIndexer, VectorIndexer}\nimport org.apache.spark.ml.feature.VectorAssembler\nimport org.apache.spark.ml.linalg.Vectors\nimport org.apache.spark.ml.feature.StringIndexer\nimport org.apache.spark.sql.functions._\n"}]},"apps":[],"jobName":"paragraph_1512426243718_-1418791713","id":"20171130-183655_136980475","dateCreated":"2017-12-04T22:24:03+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:275"},{"text":"//Reading Members data\nval members = spark.read.option(\"header\",\"true\").option(\"inferSchema\",\"true\").csv(\"s3://s3kkbox/members_v3.csv\")","dateUpdated":"2017-12-04T22:24:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"members: org.apache.spark.sql.DataFrame = [msno: string, city: int ... 4 more fields]\n"}]},"apps":[],"jobName":"paragraph_1512426243743_-1416098470","id":"20171201-200214_1952723583","dateCreated":"2017-12-04T22:24:03+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:276"},{"text":"val indexer = new StringIndexer()\n  .setInputCol(\"registered_via\")\n  .setOutputCol(\"registered_via_index\")\n  .fit(members)\n\n val indexer1= indexer.transform(members)\n \nval indexer2 = new StringIndexer()\n  .setInputCol(\"city\")\n  .setOutputCol(\"city_index\")\n  .fit(indexer1)\n\nval indexer3= indexer2.transform(indexer1).toDF\n  \nval training_AGE_0_TO_100 = indexer3.where(\"bd between 1 and 100\")\nval outliers = indexer3.where(\"bd == 0 OR bd< 0 OR bd> 100\")\n\n\nval indexer4 = new StringIndexer()\n  .setInputCol(\"bd\")\n  .setOutputCol(\"bd_index\")\n  .fit(training_AGE_0_TO_100)\n\nval indexer5= indexer4.transform(training_AGE_0_TO_100).toDF.cache\nindexer5.show()\n","dateUpdated":"2017-12-04T22:24:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"indexer: org.apache.spark.ml.feature.StringIndexerModel = strIdx_ee68f238346c\nindexer1: org.apache.spark.sql.DataFrame = [msno: string, city: int ... 5 more fields]\nindexer2: org.apache.spark.ml.feature.StringIndexerModel = strIdx_7bd893d46d0c\nindexer3: org.apache.spark.sql.DataFrame = [msno: string, city: int ... 6 more fields]\ntraining_AGE_0_TO_100: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [msno: string, city: int ... 6 more fields]\noutliers: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [msno: string, city: int ... 6 more fields]\nindexer4: org.apache.spark.ml.feature.StringIndexerModel = strIdx_9899621b978c\nindexer5: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [msno: string, city: int ... 7 more fields]\n+--------------------+----+---+------+--------------+----------------------+--------------------+----------+--------+\n|                msno|city| bd|gender|registered_via|registration_init_time|registered_via_index|city_index|bd_index|\n+--------------------+----+---+------+--------------+----------------------+--------------------+----------+--------+\n|WFLY3s7z4EZsieHCt...|   6| 32|female|             9|              20110915|                 2.0|       6.0|    14.0|\n|yLkV2gbZ4GLFwqTOX...|   4| 30|  male|             9|              20110916|                 2.0|       3.0|    13.0|\n|WH5Jq4mgtfUFXh2yz...|   5| 34|  male|             9|              20110916|                 2.0|       1.0|    17.0|\n|tKmbR4X5VXjHmxERr...|   5| 19|  male|             9|              20110917|                 2.0|       1.0|     8.0|\n|I0yFvqMoNkM8ZNHb6...|  13| 63|  male|             9|              20110918|                 2.0|       2.0|    49.0|\n|dCvvBHlaOAqgkAcv3...|  22| 18|  male|             9|              20110919|                 2.0|       4.0|     9.0|\n|6bra2AiVV8SGlm7R6...|   4| 34|female|             9|              20110919|                 2.0|       3.0|    17.0|\n|4De1jAxNRABoyRBDZ...|   4| 28|female|             9|              20110920|                 2.0|       3.0|    10.0|\n|iOzdu4IHbJxhB5CPp...|  12| 29|female|             9|              20110922|                 2.0|       8.0|    12.0|\n|fOpj0ApSXk1NVODvC...|  13| 31|female|             7|              20110923|                 3.0|       2.0|    15.0|\n|QHHKGOY5yLrGdR8WY...|   5| 19|female|             9|              20110925|                 2.0|       1.0|     8.0|\n|SpiCVwYrNY2XIpPpZ...|  15| 22|female|             9|              20110925|                 2.0|       5.0|     0.0|\n|+N2Na8js4BYLhkDXY...|   4| 23|  male|             9|              20110925|                 2.0|       3.0|     4.0|\n|F6F2FJSHqQ/TLf7fQ...|  11| 22|female|             9|              20110925|                 2.0|      10.0|     0.0|\n|FotY8kXSC6tIyCuVn...|   5| 29|  male|             9|              20110926|                 2.0|       1.0|    12.0|\n|glvtik6LgKzz/VHI8...|   9| 21|  male|             9|              20110926|                 2.0|       9.0|     1.0|\n|x+j0IrKnXLIqZawwA...|   9| 22|  male|             9|              20110926|                 2.0|       9.0|     0.0|\n|7XXoaLnR+58yBjV/d...|   5| 28|  male|             7|              20110927|                 3.0|       1.0|    10.0|\n|GqYHRxlZChiZvB1uz...|   5| 27|  male|             9|              20110927|                 2.0|       1.0|     3.0|\n|vqz848bjeylg9nGoa...|  13| 47|female|             7|              20110928|                 3.0|       2.0|    29.0|\n+--------------------+----+---+------+--------------+----------------------+--------------------+----------+--------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1512426243744_-1430334180","id":"20171130-184646_1396228170","dateCreated":"2017-12-04T22:24:03+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:277"},{"text":"val assembler = new VectorAssembler()\n  .setInputCols(Array(\"city_index\", \"registered_via_index\"))\n  .setOutputCol(\"features\")\n val output = assembler.transform(indexer5)","dateUpdated":"2017-12-04T22:24:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"assembler: org.apache.spark.ml.feature.VectorAssembler = vecAssembler_f0720b99fb34\noutput: org.apache.spark.sql.DataFrame = [msno: string, city: int ... 8 more fields]\n"}]},"apps":[],"jobName":"paragraph_1512426243751_-1431488426","id":"20171201-065451_2077932842","dateCreated":"2017-12-04T22:24:03+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:278"},{"text":"output.select(output(\"bd\")).distinct.count","dateUpdated":"2017-12-04T22:24:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res28: Long = 100\n"}]},"apps":[],"jobName":"paragraph_1512426243751_-1431488426","id":"20171130-184811_1442495054","dateCreated":"2017-12-04T22:24:03+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:279"},{"text":"val dt = new DecisionTreeClassifier()\r\n  .setLabelCol(\"bd_index\")\r\n  .setFeaturesCol(\"features\")","dateUpdated":"2017-12-04T22:24:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"dt: org.apache.spark.ml.classification.DecisionTreeClassifier = dtc_c7ea66c10935\n"}]},"apps":[],"jobName":"paragraph_1512426243751_-1431488426","id":"20171130-185317_2137415228","dateCreated":"2017-12-04T22:24:03+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:280"},{"text":"val pipeline = new Pipeline()\r\n  .setStages(Array(assembler, dt))","dateUpdated":"2017-12-04T22:24:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"pipeline: org.apache.spark.ml.Pipeline = pipeline_ec4c2d7c6843\n"}]},"apps":[],"jobName":"paragraph_1512426243751_-1431488426","id":"20171130-194502_2107577976","dateCreated":"2017-12-04T22:24:03+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:281"},{"text":"val model = pipeline.fit(indexer5)","dateUpdated":"2017-12-04T22:24:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"model: org.apache.spark.ml.PipelineModel = pipeline_ec4c2d7c6843\n"}]},"apps":[],"jobName":"paragraph_1512426243752_-1433412171","id":"20171130-194924_1124219313","dateCreated":"2017-12-04T22:24:03+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:282"},{"text":"val AGE_PRED = model.transform(outliers)\n//AGE_PRED.select(\"prediction\",\"bd\").show()\n\nAGE_PRED.sort(desc(\"bd\")).show()","dateUpdated":"2017-12-04T22:24:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"AGE_PRED: org.apache.spark.sql.DataFrame = [msno: string, city: int ... 10 more fields]\n+--------------------+----+----+------+--------------+----------------------+--------------------+----------+----------+--------------------+--------------------+----------+\n|                msno|city|  bd|gender|registered_via|registration_init_time|registered_via_index|city_index|  features|       rawPrediction|         probability|prediction|\n+--------------------+----+----+------+--------------+----------------------+--------------------+----------+----------+--------------------+--------------------+----------+\n|zEV2f5hxpJ1UA0Siy...|   4|2016|  null|             9|              20150314|                 2.0|       3.0| [3.0,2.0]|[12164.0,10852.0,...|[0.04320261971820...|       3.0|\n|+0dwtfbeXEACS3J0m...|   5|2014|  null|             9|              20150317|                 2.0|       1.0| [1.0,2.0]|[4004.0,3588.0,28...|[0.03478865285199...|      12.0|\n|aP1G1mSWP9uYaLrS4...|  14|2011|  null|             9|              20150114|                 2.0|       7.0| [7.0,2.0]|[9684.0,8360.0,71...|[0.04189197373316...|       3.0|\n|oiPysd7qWrf4q3SQJ...|   5|2011|  null|             9|              20150520|                 2.0|       1.0| [1.0,2.0]|[4004.0,3588.0,28...|[0.03478865285199...|      12.0|\n|chOY2vovti9RyCkD1...|  18|2009|  null|             9|              20150412|                 2.0|      12.0|[12.0,2.0]|[2268.0,2125.0,17...|[0.04726280034175...|       3.0|\n|G8zP9tlnj+jjfjoT4...|   3|1970|female|             3|              20150209|                 1.0|      16.0|[16.0,1.0]|[9621.0,10293.0,1...|[0.06559713093517...|       2.0|\n|m67ioS1cGDQ8NYA58...|  22|1968|  null|             9|              20150422|                 2.0|       4.0| [4.0,2.0]|[12164.0,10852.0,...|[0.04320261971820...|       3.0|\n|Sy8ZCdYvfYWf9Roqf...|   9|1958|female|             7|              20110321|                 3.0|       9.0| [9.0,3.0]|[1770.0,1388.0,12...|[0.04839900467583...|       3.0|\n|sqGrjosIXPWH6N8po...|  15|1954|  null|             9|              20150105|                 2.0|       5.0| [5.0,2.0]|[12164.0,10852.0,...|[0.04320261971820...|       3.0|\n|Fo7Czoww7KgOr6vA4...|  13|1949|  null|             9|              20150228|                 2.0|       2.0| [2.0,2.0]|[9684.0,8360.0,71...|[0.04189197373316...|       3.0|\n|L6qRekSLwf43LLMP4...|  14|1946|female|             7|              20100603|                 3.0|       7.0| [7.0,3.0]|[1404.0,1288.0,10...|[0.03711830799735...|       3.0|\n|6LumLs9aMVa6eIUIv...|   6|1937|  null|             9|              20141231|                 2.0|       6.0| [6.0,2.0]|[12164.0,10852.0,...|[0.04320261971820...|       3.0|\n|px1RLxkUz+f16N9mb...|   5|1821|  male|             9|              20070506|                 2.0|       1.0| [1.0,2.0]|[4004.0,3588.0,28...|[0.03478865285199...|      12.0|\n|WWUrvLtCYAuL/K7HO...|  17|1820|  male|             9|              20080908|                 2.0|      15.0|[15.0,2.0]|[12164.0,10852.0,...|[0.04320261971820...|       3.0|\n|ua8XFdxW9Ibid7DzZ...|  10|1820|  null|             9|              20150124|                 2.0|      13.0|[13.0,2.0]|[2770.0,2448.0,21...|[0.05211567044834...|       3.0|\n|KgnPxcXaMp5Wfxx56...|  22|1819|  null|             9|              20150330|                 2.0|       4.0| [4.0,2.0]|[12164.0,10852.0,...|[0.04320261971820...|       3.0|\n|ZcMgS9x0aIvn76QZm...|  22|1501|  null|             9|              20141110|                 2.0|       4.0| [4.0,2.0]|[12164.0,10852.0,...|[0.04320261971820...|       3.0|\n|BMn1M9ST5F6yQG1x6...|   5|1421|  male|             4|              20161224|                 0.0|       1.0| [1.0,0.0]|[2018.0,1998.0,21...|[0.05263844327933...|      11.0|\n|aRHtI+kPM5NPUTGbW...|  22|1309|  null|             9|              20150523|                 2.0|       4.0| [4.0,2.0]|[12164.0,10852.0,...|[0.04320261971820...|       3.0|\n|wHk65P4/LglCgU3Bo...|   9|1213|  null|             9|              20160303|                 2.0|       9.0| [9.0,2.0]|[904.0,774.0,670....|[0.04074458015955...|      18.0|\n+--------------------+----+----+------+--------------+----------------------+--------------------+----------+----------+--------------------+--------------------+----------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1512426243752_-1433412171","id":"20171130-195234_1603681493","dateCreated":"2017-12-04T22:24:03+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:283"},{"text":"val outlier_predicted = AGE_PRED.drop(\"features\", \"bd\",\"rawPrediction\",\"probability\").withColumnRenamed(\"prediction\", \"bd\")\n\n\nval train_members=indexer5.drop(\"bd\").withColumnRenamed(\"bd_index\", \"bd\")\n\nval members_final= outlier_predicted.unionAll(train_members)\n//members_final.show()\n","dateUpdated":"2017-12-04T22:24:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"outlier_predicted: org.apache.spark.sql.DataFrame = [msno: string, city: int ... 6 more fields]\ntrain_members: org.apache.spark.sql.DataFrame = [msno: string, city: int ... 6 more fields]\nwarning: there was one deprecation warning; re-run with -deprecation for details\nmembers_final: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [msno: string, city: int ... 6 more fields]\n"}]},"apps":[],"jobName":"paragraph_1512426243753_-1433796920","id":"20171130-200932_672407881","dateCreated":"2017-12-04T22:24:03+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:284"},{"text":"// members.count()\n// members_final.count()","dateUpdated":"2017-12-04T22:24:49+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res37: Long = 6769473\nres38: Long = 6769473\n"}]},"apps":[],"jobName":"paragraph_1512426243755_-1433027422","id":"20171130-203444_709057477","dateCreated":"2017-12-04T22:24:03+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:285"},{"text":"","dateUpdated":"2017-12-04T22:24:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1512426243756_-1434951166","id":"20171130-203855_2127300838","dateCreated":"2017-12-04T22:24:03+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:286"}],"name":"decision trees","id":"2D3265AVD","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}